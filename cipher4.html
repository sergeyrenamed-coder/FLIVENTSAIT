<!doctype html>
<html lang="ru">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Cipher 4 — Caesar</title>
<style>body{background:#051018;color:#dfeeff;font-family:monospace;padding:32px}</style></head>
<body>
<h2>Часть 4 — Шифр Цезаря</h2>
<p>Текст зашифрован сдвигом +1 (C=текст сдвигом на 1). Расшифруйте и введите.</p>
<div id="enc" style="background:#061016;padding:12px;border-radius:8px;display:inline-block"></div>
<div style="margin-top:12px"><input id="ans" style="width:100%;padding:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit" placeholder="4- ..."/></div>
<div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end"><button id="check">Проверить</button><button id="next">Дальше</button></div>
<div id="msg" style="margin-top:8px;color:#9fb0c8"></div>
<script>
const STORAGE_KEY='cryptquest_v2_parts';function load(){try{return JSON.parse(localStorage.getItem(STORAGE_KEY))}catch(e){return null}}function save(s){localStorage.setItem(STORAGE_KEY,JSON.stringify(s))}
const st=load();if(!st){alert('Прогресс не найден — вернитесь на главную.');}
function caesarEncode(s,shift){return s.split('').map(ch=>{const code=ch.charCodeAt(0);if(code>=1040 && code<=1103){const base=(code<=1071)?1040:1072;const n=(code-base+shift)%32;return String.fromCharCode(base+n);}return ch}).join('')}
const plain = `${st.parts[3].id}- ${st.parts[3].token}`;
const enc = caesarEncode(plain,1);
document.getElementById('enc').textContent = enc;
document.getElementById('check').addEventListener('click',()=>{const v=document.getElementById('ans').value.trim();if(v===plain){st.parts[3].found=true;save(st);document.getElementById('msg').textContent='Верно!'}else document.getElementById('msg').textContent='Неверно.'});
document.getElementById('next').addEventListener('click',()=>{window.location.href='cipher5.html'})
</script>

<audio id="bgMusic" autoplay loop style="display:none">
  <source src="music.mp3" type="audio/mpeg">
</audio>

<script>
  
  document.addEventListener('DOMContentLoaded', function() {
    const music = document.getElementById('bgMusic');
    music.volume = 0.5; 
    
    
    document.body.addEventListener('click', function() {
      music.play().catch(e => console.log('Auto-play prevented'));
    }, { once: true });
  });
</script>

</body>
</html>