<!doctype html>
<html lang="ru">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Cipher 3 — ROT13</title>
<style>body{background:#051018;color:#dfeeff;font-family:monospace;padding:32px}button{margin-left:8px}</style></head>
<body>
<h2>Часть 3 — ROT13</h2>
<p>На странице видна строка в ROT13. Расшифруйте и введите в поле.</p>
<div id="rot" style="background:#061016;padding:12px;border-radius:8px;display:inline-block">(скрыто)</div>
<div style="margin-top:12px"><input id="a" style="width:100%;padding:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit" placeholder="3- ..."/></div>
<div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end"><button id="check">Проверить</button><button id="next">Дальше</button></div>
<div id="msg" style="margin-top:8px;color:#9fb0c8"></div>
<script>
const STORAGE_KEY='cryptquest_v2_parts';function load(){try{return JSON.parse(localStorage.getItem(STORAGE_KEY))}catch(e){return null}}function save(s){localStorage.setItem(STORAGE_KEY,JSON.stringify(s))}
const st=load();if(!st){alert('Прогресс не найден — вернитесь на главную.');}
function rot13(s){return s.replace(/[a-zA-Z]/g,function(c){return String.fromCharCode((c<='Z'?90:122)>=(c.charCodeAt(0)+13)?c.charCodeAt(0)+13:c.charCodeAt(0)-13)})}
const txt = `${st.parts[2].id}- ${st.parts[2].token}`;
document.getElementById('rot').textContent = rot13(txt);
document.getElementById('check').addEventListener('click',()=>{const v=document.getElementById('a').value.trim();if(v===txt){st.parts[2].found=true;save(st);document.getElementById('msg').textContent='Верно!'}else document.getElementById('msg').textContent='Неверно.'});
document.getElementById('next').addEventListener('click',()=>{window.location.href='cipher4.html'})
</script>

<audio id="bgMusic" autoplay loop style="display:none">
  <source src="music.mp3" type="audio/mpeg">
</audio>

<script>
  
  document.addEventListener('DOMContentLoaded', function() {
    const music = document.getElementById('bgMusic');
    music.volume = 0.5; 
    
    
    document.body.addEventListener('click', function() {
      music.play().catch(e => console.log('Auto-play prevented'));
    }, { once: true });
  });
</script>

</body>
</html>